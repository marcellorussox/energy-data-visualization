# Energy Data Visualization Project

**Author**: Marcello Russo **Date**: `r Sys.Date()`

------------------------------------------------------------------------

## Setup

Load libraries and dataset.

```{r setup}
# Load required libraries
library(ggplot2)
library(dplyr)
library(tidytuesdayR)
library(scales)
library(tidyr)
library(forcats)
library(ggrepel)
library(rnaturalearth)
library(sf)

tuesdata <- tidytuesdayR::tt_load(2023, week = 23)

energy_data <- tuesdata$'owid-energy'
energy_data <- energy_data %>%
  filter(
    !grepl("\\(", country),
    !grepl("-", country),
    !country %in% c("Africa", "Asia", "Europe", "North America", "South America", "Oceania", "World"),
    !grepl("G7|G20|OECD|OPEC|income|region|Union|BP|EIA|Ember", country)
  )
```

------------------------------------------------------------------------

```{r utils}
# Palette
black_clr = "grey20"
white_clr = "#fafafa"
grey_clr = "#424242"

get_continent <- function(country) {
  europe <- c("Italy", "France", "Germany", "Spain", "Portugal", "Netherlands", "Belgium",
              "Sweden", "Norway", "Finland", "Denmark", "Austria", "Switzerland", "Greece",
              "Ireland", "Poland", "Czechia", "Hungary", "Slovakia", "Slovenia",
              "Croatia", "Romania", "Bulgaria", "Estonia", "Latvia", "Lithuania", "Malta",
              "Cyprus", "Luxembourg", "Iceland", "Albania", "Belarus", "Bosnia and Herzegovina",
              "North Macedonia", "Moldova", "Montenegro", "Serbia", "Ukraine", "United Kingdom")

  asia <- c("China", "Japan", "South Korea", "India", "Indonesia", "Malaysia", "Thailand",
            "Vietnam", "Philippines", "Bangladesh", "Pakistan", "Sri Lanka", "Nepal", "Iran",
            "Iraq", "Israel", "Kazakhstan", "Kuwait", "Kyrgyzstan", "Laos", "Lebanon", "Mongolia",
            "Myanmar", "North Korea", "Oman", "Palestine", "Saudi Arabia", "Singapore", "Syria",
            "Taiwan", "Tajikistan", "Timor", "Turkey", "Turkmenistan", "United Arab Emirates",
            "Uzbekistan", "Yemen", "Armenia", "Georgia", "Azerbaijan", "Jordan", "Qatar", "Bahrain",
            "Afghanistan", "Bhutan", "Maldives", "Thailand")

  africa <- c("South Africa", "Nigeria", "Egypt", "Kenya", "Morocco", "Ghana", "Algeria",
              "Tunisia", "Ethiopia", "Ivory Coast", "Senegal", "Angola", "Botswana", "Cameroon",
              "Congo", "Democratic Republic of Congo", "Gabon", "Gambia", "Guinea", "Guinea-Bissau",
              "Madagascar", "Malawi", "Mali", "Mauritania", "Mauritius", "Mozambique", "Namibia",
              "Niger", "Rwanda", "Seychelles", "Sierra Leone", "Somalia", "Sudan", "Tanzania",
              "Togo", "Uganda", "Zambia", "Zimbabwe", "Benin", "Burkina Faso", "Burundi", "Chad",
              "Comoros", "Djibouti", "Eritrea", "Equatorial Guinea", "Eswatini", "Lesotho",
              "Liberia", "Libya", "Sao Tome and Principe", "South Sudan", "Western Sahara")

  north_america <- c("United States", "Canada", "Mexico", "Bahamas", "Barbados", "Belize",
                     "Costa Rica", "Cuba", "Dominica", "Dominican Republic", "El Salvador",
                     "Grenada", "Guatemala", "Haiti", "Honduras", "Jamaica", "Nicaragua",
                     "Panama", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines",
                     "Trinidad and Tobago")

  south_america <- c("Brazil", "Argentina", "Chile", "Colombia", "Peru", "Uruguay", "Ecuador",
                     "Paraguay", "Venezuela", "Bolivia", "Guyana", "Suriname")

  oceania <- c("Australia", "New Zealand", "Fiji", "Kiribati", "Marshall Islands", "Micronesia",
               "Nauru", "Palau", "Papua New Guinea", "Samoa", "Solomon Islands", "Tonga",
               "Tuvalu", "Vanuatu")

  if (country %in% europe) {
    return("Europe")
  } else if (country %in% asia) {
    return("Asia")
  } else if (country %in% africa) {
    return("Africa")
  } else if (country %in% north_america) {
    return("North America")
  } else if (country %in% south_america) {
    return("South America")
  } else if (country %in% oceania) {
    return("Oceania")
  } else {
    return("Unknown")
  }
}
```

------------------------------------------------------------------------

## Plot 1: Top 10 Energy Consumers (2018)

**Question**: Which are the countries that consume most and what is the consumption per capita?

```{r plot1}
top10_total <- energy_data %>%
  filter(year == 2018) %>%
  mutate(
    energy_per_capita = round(energy_per_capita, 0),
    label_text = paste0(scales::comma(energy_per_capita), " kWh/person")
  ) %>%
  arrange(desc(electricity_demand)) %>%
  slice_head(n = 10)

ggplot(top10_total, aes(x = electricity_demand/1000, 
                       y = reorder(country, electricity_demand))) +
  geom_col(fill = "#1f78b4", width = 0.7, alpha = 0.8) +
  geom_text(
    aes(label = label_text),
    hjust = -0.1,
    color = grey_clr,
    size = 4,
    fontface = "bold"
  ) +
  scale_x_continuous(
    name = "PWh",
    limits = c(0, 8),
    labels = scales::comma_format(),
    position = "top"
  ) +
  labs(
    title = "Top 10 Energy Consumers (2018)",
    y = ""
  ) +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = white_clr, color = NA),
    panel.background = element_rect(fill = white_clr, color = NA),
    plot.title.position = "plot",
    plot.title = element_text(
      face = "bold",
      size = 16,
      hjust = 0,
      margin = margin(b = 15),
      colour = black_clr
    ),
    axis.title.x = element_text(
      face = "bold",
      colour = black_clr
    ),
    axis.text.x.top = element_text(
      margin = margin(10)
    ),
    axis.text.y = element_text(
      face = "bold", 
      size = 12,
      margin = margin(r = 5),
      colour = grey_clr,
    ),
    panel.grid.major.y = element_blank(),
    
    plot.margin = margin(1, 1, 1, 1, "cm")
  )

ggsave("plots/1_top10_energy_consumers.png", width = 15, height = 9, dpi = 300, bg = white_clr)
```

**Explanation**

------------------------------------------------------------------------

## Plot 2: GDP per vs. Per Capita Energy Consumption

```{r plot2}
# Data processing corretto
plot1data <- energy_data %>%
  filter(year == 2018) %>%
  mutate(continent = sapply(country, get_continent)) %>%
  filter(continent != "Unknown") %>%
  mutate(
    gdp_per_capita = gdp / population
  ) %>%
  filter(
    !is.na(gdp), 
    !is.na(population),
    !is.na(energy_per_capita),
    !is.na(continent)
  )

# Plot con scala lineare
ggplot(plot1data, aes(x = gdp_per_capita, y = energy_per_capita, color = continent)) +
  geom_point(alpha = 0.8, size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = grey_clr, linetype = "dashed") +
  scale_x_log10(
    name = "GDP p.c (USD)",
    labels = scales::dollar_format(accuracy = 1),
    breaks = c(500, 1000, 2000, 5000, 10000, 20000, 50000, 100000, 200000),
    limits = c(500, 100000)
  ) +
  scale_y_log10(
    name = "Energy p.c (kWh)",
    labels = scales::comma_format(),
    breaks = c(200, 500, 1000, 2000, 5000, 10000, 20000, 50000, 100000),
    limits = c(200, 200000)
  ) +
  scale_color_brewer(palette = "Set1") +
  labs(
    title = "Energy use per capita vs GDP per capita (2018, log-log scale)",
    color = "Continent"
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    plot.title = element_text(
      face = "bold",
      size = 20,
      hjust = 0,
      margin = margin(b = 15)
    ),
    axis.title.x = element_text(
      face = "bold",
      size = 16,
      margin = margin(t = 15, b = 10)
    ),
    axis.text.x = element_text(
      size = 14
    ),
    axis.title.y = element_text(
      face = "bold",
      size = 16,
      margin = margin(r = 15, l = 10)
    ),
    axis.text.y = element_text(
      size = 14
    ),
    plot.title.position = "plot",
    legend.title = element_text(
      face = "bold",
      size = 16
    ),
    legend.text = element_text(
      size = 14
    ),
    plot.margin = margin(1, 1, 1, 1, "cm"),
    panel.background = element_rect(fill = white_clr, color = NA),
    plot.background = element_rect(fill = white_clr, color = NA)
  )

ggsave("plots/2_energy_gdp_plot.png", width = 16, height = 9, dpi = 300, bg = white_clr)
```

------------------------------------------------------------------------

## Plot 3: Carbon Intensity vs. Fossil Dependency

**Question**: Which countries have high carbon intensity despite low fossil fuel dependency?

```{r plot3}
plot3_data <- energy_data %>%
  filter(year == 2018) %>%
  mutate(continent = sapply(country, get_continent)) %>%
  filter(continent != "Unknown") %>%
  drop_na(carbon_intensity_elec, fossil_share_energy)

ggplot(plot3_data, aes(x = fossil_share_energy, y = carbon_intensity_elec, color = continent)) +
  geom_point(size = 3, alpha = 0.8) +
  geom_text_repel(
    data = subset(plot3_data, carbon_intensity_elec > 500 & fossil_share_energy < 50),
    aes(label = country), 
    size = 3.5,
    box.padding = 0.5,
    max.overlaps = 20
  ) +
  scale_color_brewer(palette = "Set1") +
  scale_x_continuous(
    name = "Fossil Fuel Share of Energy (%)",
    limits = c(0, NA),  # Asse X parte da 0
    expand = expansion(mult = c(0, 0.05))  # NO '+' QUI
  ) +  # Parentesi chiusa corretta
  labs(
    title = "Carbon Intensity vs. Fossil Fuel Dependency",
    y = expression(bold(paste("Carbon Intensity (", gCO[2]/kWh, ")"))),
    color = "Continent"
  ) +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = white_clr, color = NA),
    panel.background = element_rect(fill = white_clr, color = NA),
    plot.title.position = "plot",
    plot.title = element_text(
      face = "bold",
      size = 20,
      hjust = 0,
      margin = margin(b = 15)
    ),
    axis.title = element_text(face = "bold", color = black_clr, size = 16),
    axis.title.x = element_text(margin = margin(t = 15, b = 10)),
    axis.title.y = element_text(margin = margin(r = 15, l = 10)),
    axis.text = element_text(
      color = grey_clr,
      size = 14
    ),
    legend.position = "bottom",
    legend.title = element_text(
      face = "bold",
      size = 16),
    legend.text = element_text(
      size = 14,
      colour = grey_clr
    ),
    panel.grid.minor = element_blank(),
    plot.margin = margin(1, 1, 1, 1, "cm")
  )

ggsave("plots/3_carbon_fossil_plot.png", width = 10, height = 10, dpi = 300, bg = white_clr)
```

------------------------------------------------------------------------

## Plot 4: Renewables share distribution in the world (2018)

```{r plot4}
renewable_2018 <- energy_data %>%
  filter(year == 2018) %>%
  drop_na(renewables_share_elec)

ggplot(renewable_2018, aes(x = renewables_share_elec)) +
  geom_density(
    fill = "#4daf4a", 
    alpha = 0.3, 
    color = "#4daf4a", 
    linewidth = 0.8
  ) +
  geom_vline(
    xintercept = median(renewable_2018$renewables_share_elec),
    color = "#984ea3",
    linetype = "dashed",
    linewidth = 1
  ) +
  scale_x_continuous(
    name = "Renewable Energy Share (%)",
    limits = c(0, 100),
    labels = scales::percent_format(scale = 1),
    expand = c(0, 0)
  ) +
  scale_y_continuous(
    name = "Density",
    labels = scales::comma_format()
  ) +
  labs(
    title = "Global Renewable Energy Share Distribution (2018)",
    subtitle = paste(
      "Density curve | Median =", 
      round(median(renewable_2018$renewables_share_elec), 1), "%"
    )
  ) +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = white_clr, color = NA),
    panel.background = element_rect(fill = white_clr, color = NA),
    plot.title.position = "plot",
    plot.title = element_text(
      face = "bold",
      size = 20,
      hjust = 0,
      colour = black_clr,
      margin = margin(b = 10)
    ),
    plot.subtitle = element_text(
      hjust = 0,
      margin = margin(b = 15),
      size = 16,
      colour = grey_clr,
    ),
    axis.title = element_text(
      face = "bold",
      color = black_clr,
      size = 16
    ),
    axis.title.x = element_text(
      margin = margin(t = 15, b = 10)
    ),
    axis.title.y = element_text(
      margin = margin(r = 15, l = 10)
    ),
    axis.text = element_text(
      color = grey_clr,
      size = 14
    ),
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    plot.margin = margin(1, 1, 1, 1, "cm")
  )

ggsave("plots/4_renewable_distribution_plot.png", width = 19, height = 9, dpi = 300, bg = white_clr)
```

------------------------------------------------------------------------

## Plot 5: Global Renewable Energy Share Map (2018)

```{r plot5}
world <- ne_countries(scale = "medium", returnclass = "sf")

iso_corrections <- tibble(
  iso_a3 = c("FRA", "NOR", "SMR", "MCO", "LIE", "AND", "CUW", "SXM"),
  correct_iso = c("FRA", "NOR", "SMR", "MCO", "LIE", "AND", "CUW", "SXM")
)

energy_map <- world %>%
  left_join(iso_corrections, by = "iso_a3") %>%
  mutate(iso_merged = coalesce(correct_iso, iso_a3)) %>%
  left_join(
    energy_data %>%
      filter(year == 2018) %>%
      select(iso_code, renewables_share_elec),
    by = c("iso_merged" = "iso_code")
  ) %>%
  mutate(
    renewables_share_elec = case_when(
      name == "Norway" ~ energy_data$renewables_share_elec[energy_data$country == "Norway" & energy_data$year == 2018],
      name == "France" ~ energy_data$renewables_share_elec[energy_data$country == "France" & energy_data$year == 2018],
      TRUE ~ renewables_share_elec
    )
  )

ggplot(energy_map) +
  geom_sf(aes(fill = renewables_share_elec), color = white_clr, linewidth = 0.2) +
  scale_fill_gradient(
    name = "Renewables share (%)",
    low = "grey90",  
    high = "#005a32",
    na.value = "grey70",
    limits = c(0, 100),
    labels = scales::percent_format(scale = 1),
    guide = guide_colorbar(
      barwidth = 1.8,
      barheight = 25,
      direction = "vertical",
      show.title = FALSE,
      label.hjust = 0.5,
      ticks.linewidth = 1.5
    )
  ) +
  labs(
    title = "Global Renewable Energy Share Map (2018)"
  ) +
  theme_void() +
  theme(
    plot.background = element_rect(fill = white_clr, color = NA),
    plot.title = element_text(
      face = "bold",
      size = 22,
      hjust = 0,
      colour = black_clr,
      margin = margin(b = 10, l = 10)
    ),
    legend.title = element_blank(),
    legend.position.inside = c(1.1, 0.5),
    legend.text = element_text(
      size = 14,
      colour = grey_clr
    ),
    plot.margin = margin(1, 1, 1, 1, "cm")
  )

ggsave("plots/5_world_renewables_map.png", 
       width = 18,
       height = 9, 
       dpi = 600, 
       bg = white_clr)
```

------------------------------------------------------------------------

## Plot 6: Solar and Wind Energy Leaders

**Question**: Which countries lead in solar and wind energy adoption?

```{r plot6}
top_5 <- energy_data %>%
  filter(year == 2018) %>%
  slice_max(order_by = electricity_generation, n = 5) %>% 
  arrange(desc(renewables_share_elec)) %>%
  mutate(
    country = fct_reorder(country, renewables_share_elec),
    electricity_label = paste0(round(electricity_generation/1000, 1))
  )

top_5_long <- top_5 %>%
  pivot_longer(
    cols = c(solar_share_elec, wind_share_elec, hydro_share_elec, 
             other_renewables_share_elec, renewables_share_elec),
    names_to = "source",
    values_to = "value"
  ) %>%
  mutate(
    source = recode(source,
                    "solar_share_elec" = "Solar",
                    "wind_share_elec" = "Wind",
                    "hydro_share_elec" = "Hydro",
                    "other_renewables_share_elec" = "Other",
                    "renewables_share_elec" = "Total")
  )


top_5_long <- top_5_long %>%
  mutate(
    y_offset = case_when(
      source == "Solar" ~ as.numeric(country) + 0.3,
      source == "Wind" ~ as.numeric(country) + 0.15,
      source == "Hydro" ~ as.numeric(country),
      source == "Other" ~ as.numeric(country) - 0.15,
      source == "Total" ~ as.numeric(country) - 0.3
    )
  )

ggplot(top_5_long, aes(x = value, y = y_offset, color = source)) +
  geom_segment(aes(x = 0, xend = value, y = y_offset, yend = y_offset), 
               linewidth = 1.5, alpha = 0.9) +
  geom_point(size = 4.5, shape = 19) +
  geom_text(
    data = distinct(top_5, country, electricity_label, renewables_share_elec),
    aes(
      x = 20,
      y = as.numeric(country),
      label = paste0(top_5$electricity_label, " PWh")
    ),
    inherit.aes = FALSE,
    hjust = 0,
    size = 4.5,
    fontface = "bold",
    color = grey_clr,
    lineheight = 0.8
  ) +
  scale_x_continuous(
    limits = c(0, 27),
    breaks = seq(0, 30, 5),
    position = "top"
  ) +
  scale_y_continuous(
    breaks = 1:5,
    labels = levels(top_5$country),
    expand = expansion(add = 0.2)
  ) +
  scale_color_manual(
    name = "",
    values = c("Solar" = "#FFB14E",
               "Wind" = "#aaaaff",
               "Hydro" = "#0a77B4",
               "Other" = "#cccc00",
               "Total" = "#2CA02C"),
    breaks = c("Solar", "Wind", "Hydro", "Other", "Total")
  ) +
  labs(
    title = "Renewables Share in the Top 5 Global Energy Producers",
    subtitle = "Labels show total electricity production (renewable + non-renewable)",
    y = ""
  ) +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = white_clr, color = NA),
    panel.background = element_rect(fill = white_clr, color = NA),
    axis.title.x.top = element_blank(),
    axis.text.y = element_text(
      face = "bold", 
      size = 14,
      colour = grey_clr
    ),
    axis.text.x = element_text(
      size = 14, 
    ),
    plot.title = element_text(
      face = "bold",
      colour = black_clr,
      size = 20, 
      hjust = 0,
      margin = margin(b = 10)
    ),
    plot.title.position = "plot",
    plot.subtitle = element_text(
      hjust = 0,
      size = 14, 
      color = grey_clr,
      margin = margin(b = 15)
    ),
    legend.text = element_text(
      size = 14,
      colour = grey_clr
    ),
    plot.margin = margin(1, 1, 1, 1, "cm"),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(),
    legend.position = "bottom"
  )

ggsave("plots/6_renewable_leaders_plot.png", 
       width = 16, 
       height = 9, 
       dpi = 300, 
       bg = white_clr)
```

**Explanation**:\
- A **dodged bar chart** compares the top 10 countries for solar and wind energy.\
- Data is pivoted to long format for easy faceting.\
- Gold (`#FFD700`) represents solar, blue (`#4682B4`) represents wind.

------------------------------------------------------------------------

## Plot 7: Development of Renewable Energy in Brazil, Italy and Spain

**Question**: Do countries with higher population growth experience larger changes in energy demand?

```{r plot7}
# Filter data for Italy, Spain and Poland and calculate renewable share
plot3 <- energy_data %>%
  filter(country %in% c("Italy", "Spain", "Poland")) %>%
  mutate(renewable_share = renewables_share_elec) %>%
  drop_na(year, renewable_share)

# Create line plot
ggplot(plot3, aes(x = year, y = renewable_share, color = country)) +
  geom_point(size = 2) +  # Add points for better visibility of data points
  scale_color_manual(values = c("Italy" = "blue", "Spain" = "gold", "Poland" = "red")) +
  labs(title = "Renewable Energy Share Over Time in Italy, Spain and Poland",
       x = "Year",
       y = "Share of Electricity Generation (%)",
       color = "Country") +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
    axis.title = element_text(size = 12)
  ) +
  scale_x_continuous(breaks = seq(min(plot3$year), max(plot3$year), by = 5))  # Adjust x-axis breaks

ggsave("plots/renewable_ita_spa_pol.png", width = 10, height = 7, dpi = 300, bg = white_clr)
```

**Explanation**:\
- Percentage changes in population and electricity demand are calculated over a 10-year window.\
- A **regression line** (`geom_smooth`) shows the overall trend.\
- Points represent individual countries.

------------------------------------------------------------------------

## Plot 8: Energy Mix by Continent

**Question**: How does the energy mix vary by continent?

```{r plot8}
# Prepara i dati per il lollipop chart
plot6_lollipop <- energy_data %>% 
  filter(year == 2018) %>%
  mutate(continent = sapply(country, get_continent)) %>%
  filter(continent != "Unknown") %>%
  group_by(continent) %>%
  summarise(
    fossil = sum(fossil_electricity, na.rm = TRUE),
    renewables = sum(renewables_electricity, na.rm = TRUE),
    nuclear = sum(nuclear_electricity, na.rm = TRUE)
  ) %>%
  pivot_longer(
    cols = -continent,
    names_to = "source",
    values_to = "share"
  ) %>%
  mutate(
    source = factor(source, levels = c("fossil", "renewables", "nuclear")),
    continent = factor(continent),
    # Assegna offset verticali per raggruppamento
    y_offset = case_when(
      source == "fossil" ~ as.numeric(continent) + 0.2,
      source == "renewables" ~ as.numeric(continent),
      source == "nuclear" ~ as.numeric(continent) - 0.2
    )
  )

# Crea il grouped lollipop chart
ggplot(plot6_lollipop, aes(x = share, y = y_offset, color = source)) +
  geom_segment(aes(x = 0, xend = share, y = y_offset, yend = y_offset), 
               linewidth = 0.7, alpha = 0.8) +
  geom_point(size = 3.5) +
  scale_y_continuous(
    breaks = 1:length(unique(plot6_lollipop$continent)),
    labels = levels(plot6_lollipop$continent),
    expand = expansion(add = 0.5)
  ) +
  scale_color_manual(
    values = c("fossil" = "#E69F00", 
               "renewables" = "#009E73", 
               "nuclear" = "#0072B2"),
    labels = c("Fossil Fuels", "Renewables", "Nuclear")
  ) +
  labs(
    title = "Energy Mix by Continent (2018)",
    subtitle = "Grouped lollipop chart showing average energy shares",
    x = "Share of Energy Mix (%)",
    y = NULL,
    color = "Energy Source"
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    axis.text.y = element_text(face = "bold", size = 10),
    panel.grid.major.y = element_blank(),
    plot.title = element_text(face = "bold", size = 14)
  )

ggsave("plots/continent_energy_mix.png", width = 10, height = 7, dpi = 300, bg = white_clr)
```

**Explanation**:\
- **Quadrant analysis** splits the plot into four regions using median values.\
- Points are colored by continent to highlight regional patterns.\
- High consumption + low efficiency (top-left quadrant) may indicate wasteful economies.

------------------------------------------------------------------------

## Plot 9: Nuclear Share Variations

**Question**: Quali paesi hanno ridotto/aumentato maggiormente il nucleare nell'ultimo decennio?

```{r plot9}
energy_data %>% 
  filter(year %in% c(1998, 2022)) %>% 
  group_by(country) %>%
  reframe(change = (nuclear_share_elec[year == 2022] - nuclear_share_elec[year == 1998])) %>% 
  filter(change != 0) %>%
  ggplot(aes(x = change, y = reorder(country, change), fill = change > 0)) +
  geom_col(width = 0.8) +
  geom_vline(xintercept = 0, color = "gray40", linewidth = 0.3) +
  scale_fill_manual(
    values = c("#ca0020", "#0571b0"),
    labels = c("Declino", "Crescita"),
    name = "Direzione"
  ) +
  scale_x_continuous(
    labels = scales::label_percent(scale = 1),
    breaks = seq(-30, 30, 5)
  ) +
  labs(
    title = "Variazioni nella Quota Nucleare (1998-2018)",
    subtitle = "Top 10 paesi per variazione assoluta",
    x = "Variazione percentuale (punti)",
    y = ""
  ) +
  theme_minimal() +
  theme(
    panel.grid.major.y = element_blank(),
    legend.position = "top",
    plot.title = element_text(face = "bold", size = 14),
    axis.text.y = element_text(face = "bold")
  )
```

**Explanation**:\
- A **stacked bar chart** shows the proportional contribution of each energy source.\
- Fossil fuels dominate in some continents, while others have more balanced mixes.

------------------------------------------------------------------------

## Saving the Notebook

Render the notebook to HTML/PDF by clicking "Knit" in RStudio.
